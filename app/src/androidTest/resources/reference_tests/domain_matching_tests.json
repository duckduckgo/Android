{
    "domainTests": {
        "name": "URL-matching",
        "desc": "interactions between root domain and resource URLs from tracker lists",
        "tests": [
            {
                "name": "same party tracker",
                "siteURL": "https://bad.third-party.site/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": []
            },
            {
                "name": "bad loads same root domain resources",
                "siteURL": "https://bad.third-party.site/",
                "requestURL": "https://third-party.site/",
                "requestType": "script",
                "expectAction": null,
                "exceptPlatforms": []
            },
            {
                "name": "root domain matches itself, not a subdomain",
                "siteURL": "https://third-party.site/",
                "requestURL": "https://third-party.site/stuff",
                "requestType": "script",
                "expectAction": null,
                "exceptPlatforms": []
            },
            {
                "name": "same party ignore",
                "siteURL": "https://ignore.test/",
                "requestURL": "https://ignore.test/",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "tracker loads ignore",
                "siteURL": "https://bad.third-party.site/",
                "requestURL": "https://ignore.test/",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "ignore image exception loads tracker image",
                "siteURL": "https://ignore.test/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "ignore image exception doesn't load tracker script",
                "siteURL": "https://ignore.test/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "notignore doesn't load tracker",
                "siteURL": "https://notignore.test/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "random blocks tracker",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "random blocks cname tracker",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://bad.cnames.test/something",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "uncloacked tracker should contain original path and be checked against the ignore rules",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://bad.cnames.test/breakage",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "random allows sub.cname tracker",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://also.bad.cnames.test/something",
                "requestType": "script",
                "expectAction": null,
                "exceptPlatforms": [
                    "ios-browser",
                    "web-extension-mv3"
                ]
            },
            {
                "name": "random allows notbad cname tracker",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://notbad.cnames.test/something",
                "requestType": "script",
                "expectAction": null
            },
            {
                "name": "tracker.test CNAME'd to ignore.test should still be blocked",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://fake-ignore.tracker.test/spy/script.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "Tracker URL, same entity; CNAME is tracker (ignore): ignore",
                "siteURL": "https://third-party.site/",
                "requestURL": "https://fake-ignore.tracker.test/spy/script.js",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "Non tracker URL; CNAME is tracker (block), same entity: ignore",
                "siteURL": "https://third-party.site/",
                "requestURL": "https://bad.cnames.test/spy/script.js",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "no blocklist entry for an uncloacked domain - request should not be blocked",
                "siteURL": "https://randomsite123.com/",
                "requestURL": "https://domain.cloaked.test/some/script.js",
                "requestType": "script",
                "expectAction": null
            },
            {
                "name": "sub.ignore loads tracker",
                "siteURL": "https://sub.ignore.test/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "tracker loads ignore resource type",
                "siteURL": "https://bad.third-party.site/",
                "requestURL": "https://ignore.test/",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "tracker blocks non-ignore resource type",
                "siteURL": "https://bad.third-party.site/",
                "requestURL": "https://ignore.test/",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "tracker loads random",
                "siteURL": "https://bad.third-party.site/",
                "requestURL": "https://random.test/",
                "requestType": "script",
                "expectAction": null
            },
            {
                "name": "random does not load tracker",
                "siteURL": "https://random.test/",
                "requestURL": "https://bad.third-party.site/",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "random loads itself",
                "siteURL": "https://random.test/",
                "requestURL": "https://random.test/",
                "requestType": "script",
                "expectAction": null
            },
            {
                "name": "random loads ignore path on tracker",
                "siteURL": "https://random.test/",
                "requestURL": "https://bad.third-party.site/ignore",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "random loads broken.site",
                "siteURL": "https://random.test/",
                "requestURL": "https://broken.third-party.site/",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "random loads randomsub.third-party.site",
                "siteURL": "https://random.test/",
                "requestURL": "https://randomsub.third-party.site/",
                "requestType": "script",
                "expectAction": null
            },
            {
                "name": "random doesn't load randomsub.tracker",
                "siteURL": "https://random.test/",
                "requestURL": "https://randomsub.tracker.test/",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "tracker loads permitted for same entity",
                "siteURL": "https://third-party.site/",
                "requestURL": "https://tracker.test/",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "block tracker path in ignore domain",
                "siteURL": "https://random.test/",
                "requestURL": "https://ignore.test/tracker?abc=2",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "ports are ignored when matching rules",
                "siteURL": "https://random.test/",
                "requestURL": "https://bad.third-party.site:8080/ignore",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "web-extension",
                    "ios-browser",
                    "web-extension-mv3"
                ]
            },
            {
                "name": "unknown rule action ignored, default block",
                "siteURL": "https://random.test/",
                "requestURL": "https://tracker.test/unsupported-action",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "unknown rule action ignored, default ignore",
                "siteURL": "https://random.test/",
                "requestURL": "https://ignore.test/unsupported-action",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "block tracker with site matching options domains",
                "siteURL": "https://site-that-tracks.com",
                "requestURL": "https://sometimes-bad.third-party.site/option-blocking-only",
                "requestType": "image",
                "expectAction": "block"
            },
            {
                "name": "test option match fallback to next rule",
                "siteURL": "https://site-that-tracks.com",
                "requestURL": "https://sometimes-bad.third-party.site/option-fallback/option-blocking-only2",
                "requestType": "image",
                "expectAction": "block"
            },
            {
                "name": "don't block tracker with site not matching the option subdomain",
                "siteURL": "https://ok-subdomain.also-site-that-tracks.com",
                "requestURL": "https://sometimes-bad.third-party.site/option-blocking-only",
                "requestType": "image",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "web-extension",
                    "web-extension-mv3"
                ]
            },
            {
                "name": "don't block tracker with site matching options domains but not types",
                "siteURL": "https://site-that-tracks.com",
                "requestURL": "https://sometimes-bad.third-party.site/option-blocking-only",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "don't block tracker with site matching options domains and exceptions",
                "siteURL": "https://site-that-tracks.com",
                "requestURL": "https://sometimes-bad.third-party.site/option-blocking-only",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "don't block tracker with site not matching options domains",
                "siteURL": "https://example.com",
                "requestURL": "https://sometimes-bad.third-party.site/option-blocking-only",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "block default block tracker matching option domains",
                "siteURL": "https://example.com",
                "requestURL": "https://tracker.test/with-options",
                "requestType": "image",
                "expectAction": "block"
            },
            {
                "name": "block default block tracker not matching option domains",
                "siteURL": "https://example2.com",
                "requestURL": "https://tracker.test/with-options",
                "requestType": "image",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path matches ignore",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/ignore1",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - path matches ignore (sandwiched) (type=script)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/request-1b",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - path matches ignore (sandwiched) (type=font)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/request-1b",
                "requestType": "font",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path matches, exception does not (wrong domain, correct type)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/request-1a",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path matches, exception does not (correct domain, wrong type)",
                "siteURL": "https://example2.com",
                "requestURL": "https://standard1.test/request-1a",
                "requestType": "image",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path (2) matches, exception does not (wrong domain, correct type)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/request-1",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path (2) matches, exception does not (correct domain, wrong type)",
                "siteURL": "https://example3.com",
                "requestURL": "https://standard1.test/request-1",
                "requestType": "stylesheet",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path matches, exception does not (should not confuse with following exception)",
                "siteURL": "https://example3.com",
                "requestURL": "https://standard1.test/request-1a",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path matches, exception matches",
                "siteURL": "https://example2.com",
                "requestURL": "https://standard1.test/request-1a",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - path matches, exception matches (2)",
                "siteURL": "https://example2a.com",
                "requestURL": "https://standard1.test/request-1a",
                "requestType": "stylesheet",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard1 - path (2) matches, exception matches",
                "siteURL": "https://example3.com",
                "requestURL": "https://standard1.test/request-1",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - path (2) matches, exception matches (2)",
                "siteURL": "https://example3a.com",
                "requestURL": "https://standard1.test/request-1",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - following ignore matches",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/request",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - following ignore matches (2)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/request-2",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "standard1 - fall back to default",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard1.test/other",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "standard2 - path matches block",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/block",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "standard2 - path matches ignore (sandwiched) (type=script)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/request-1b",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - path matches ignore (sandwiched) (type=font)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/request-1b",
                "requestType": "font",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - path matches, exception does not (wrong domain, correct type)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/request-1a",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "standard2 - path matches, exception does not (correct domain, wrong type)",
                "siteURL": "https://example2.com",
                "requestURL": "https://standard2.test/request-1a",
                "requestType": "image",
                "expectAction": "block"
            },
            {
                "name": "standard2 - path (2) matches, exception does not (wrong domain, correct type)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/request-1",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "standard2 - path (2) matches, exception does not (correct domain, wrong type)",
                "siteURL": "https://example3.com",
                "requestURL": "https://standard2.test/request-1",
                "requestType": "stylesheet",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - path matches, exception does not (should not confuse with following exception)",
                "siteURL": "https://example3.com",
                "requestURL": "https://standard2.test/request-1a",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "standard2 - path matches, exception matches",
                "siteURL": "https://example2.com",
                "requestURL": "https://standard2.test/request-1a",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - path matches, exception matches (2)",
                "siteURL": "https://example2a.com",
                "requestURL": "https://standard2.test/request-1a",
                "requestType": "stylesheet",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - path (2) matches, exception matches",
                "siteURL": "https://example3.com",
                "requestURL": "https://standard2.test/request-1",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - path (2) matches, exception matches (2)",
                "siteURL": "https://example3a.com",
                "requestURL": "https://standard2.test/request-1",
                "requestType": "image",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - following ignore matches",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/request",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - following ignore matches (2)",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/request-2",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "standard2 - block following ignore matches",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/reques",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "standard2 - fall back to default",
                "siteURL": "https://example1.com",
                "requestURL": "https://standard2.test/other",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "robustness1 - default:block, less general block after ignore obeys ignore",
                "siteURL": "https://example1.com",
                "requestURL": "https://robustness1.test/request-1",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "robustness2 - default:ignore, less general block after ignore obeys ignore",
                "siteURL": "https://example1.com",
                "requestURL": "https://robustness2.test/request-1",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options1 - ignore on catch ignore after options",
                "siteURL": "https://example2.com",
                "requestURL": "https://options1.test/script.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options1 - block on catch ignore after options",
                "siteURL": "https://example.com",
                "requestURL": "https://options1.test/script2.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "options2 - ignore on non-matching options fallback ignore",
                "siteURL": "https://example2.com",
                "requestURL": "https://options2.test/script.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options2 - block on matching options (fallthrough subpath)",
                "siteURL": "https://example3.com",
                "requestURL": "https://options2.test/script.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options2 - block on matching options (fallthrough)",
                "siteURL": "https://example2.com",
                "requestURL": "https://options2.test/script2.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options2 - block on matching options (subpath match)",
                "siteURL": "https://example3.com",
                "requestURL": "https://options2.test/script2.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options3 - ignore on non-matching options (fallback exception)",
                "siteURL": "https://example2.com",
                "requestURL": "https://options3.test/script.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options3 - block on non-matching options (non-matching exception)",
                "siteURL": "https://example4.com",
                "requestURL": "https://options3.test/script.js",
                "requestType": "stylesheet",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options3 - block on matching options (fallthrough subpath)",
                "siteURL": "https://example3.com",
                "requestURL": "https://options3.test/script.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options3 - block on matching options (fallthrough)",
                "siteURL": "https://example2.com",
                "requestURL": "https://options3.test/script2.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "options3 - block on matching options (subpath match)",
                "siteURL": "https://example3.com",
                "requestURL": "https://options3.test/script2.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options4 - default:block - both exceptions and options match (just domains) ignores",
                "siteURL": "https://example1.com",
                "requestURL": "https://options4.test/script1.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options4 - default:block - both exceptions and options match (domain + type) ignores",
                "siteURL": "https://example1.com",
                "requestURL": "https://options4.test/script2.js",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "options4 - default:block - options match, exceptions only partially match - block",
                "siteURL": "https://example1.com",
                "requestURL": "https://options4.test/script3.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "options4 - default:block - options don't match, exceptions match - block",
                "siteURL": "https://example1.com",
                "requestURL": "https://options4.test/script4.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser",
                    "web-extension-mv3"
                ]
            },
            {
                "name": "options5 - default:ignore - both exceptions and options match (just domains) ignores",
                "siteURL": "https://example1.com",
                "requestURL": "https://options5.test/script1.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options5 - default:ignore - both exceptions and options match (domain + type) ignores",
                "siteURL": "https://example1.com",
                "requestURL": "https://options5.test/script2.js",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "options5 - default:ignore - options match, exceptions only partially match - block",
                "siteURL": "https://example1.com",
                "requestURL": "https://options5.test/script3.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "options6 - default:block - options match with action:ignore",
                "siteURL": "https://example1.com",
                "requestURL": "https://options6.test/script1.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options6 - default:block - rule matches, options don't, action:ignore",
                "siteURL": "https://example2.com",
                "requestURL": "https://options6.test/script1.js",
                "requestType": "script",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser",
                    "web-extension-mv3"
                ]
            },
            {
                "name": "options7 - default:ignore - options match with action:ignore",
                "siteURL": "https://example1.com",
                "requestURL": "https://options7.test/script1.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options7 - default:ignore - rule matches, options don't, action:ignore",
                "siteURL": "https://example2.com",
                "requestURL": "https://options7.test/script1.js",
                "requestType": "script",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options-trailing-exception - block on options match",
                "siteURL": "https://example.com",
                "requestURL": "https://options-trailing-exception.test/script.js",
                "requestType": "stylesheet",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options-trailing-exception - ignore on no options match",
                "siteURL": "https://example2.com",
                "requestURL": "https://options-trailing-exception.test/script.js",
                "requestType": "stylesheet",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options-trailing-ignore - block on options match",
                "siteURL": "https://example.com",
                "requestURL": "https://options-trailing-ignore.test/script.js",
                "requestType": "stylesheet",
                "expectAction": "block",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "options-trailing-ignore - ignore on no options match",
                "siteURL": "https://example2.com",
                "requestURL": "https://options-trailing-ignore.test/script.js",
                "requestType": "stylesheet",
                "expectAction": "ignore",
                "exceptPlatforms": [
                    "ios-browser"
                ]
            },
            {
                "name": "format.test - supports unescaped slashes",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/test1.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - supports simple regexp - matching request",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/1/test2.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - supports simple regexp - nonmatching request",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/a/test2.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - supports CBR regexp - matching request (1)",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/aa123b.cdeffffg/test2b.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - supports CBR regexp - matching request (2)",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/ab.cd/test2b.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - supports CBR regexp - nonmatching request (1)",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/aa123b.cffffg/test2b.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - supports CBR regexp - nonmatching request (2)",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/ab1cd/test2b.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - with subdomain - match on sub subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub0.sub1.sub2.format.test/test4.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - with subdomain - don't match on just lower subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1.format.test/test4.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - with subdomain - match on full subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1.sub2.format.test/test4.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - with subdomain - don't match for incorrect subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1nsub2.format.test/test4.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - with subdomain - don't match on incorrect subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub0.sub2.format.test/test4.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - with subdomain and regexp - match on sub subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub0.sub1.sub2.format.test/a/test4a.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - with subdomain and regexp - don't match on just lower subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1.format.test/a/test4a.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - with subdomain and regexp - match on full subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1.sub2.format.test/a/test4a.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - with subdomain and regexp - don't match for incorrect subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1nsub2.format.test/a/test4a.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - with subdomain and regexp - don't match on incorrect subdomain",
                "siteURL": "https://example.com",
                "requestURL": "https://sub0.sub2.format.test/a/test4a.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - domain in rule - match on full request",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1.format.test/sub2.format.test/test4b.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - domain in rule - don't match the inner request",
                "siteURL": "https://example.com",
                "requestURL": "https://sub2.format.test/test4b.js",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "format.test - no escape on domain - matching request",
                "siteURL": "https://example.com",
                "requestURL": "https://format.test/test5.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - no escape on subdomain - match with periods",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1.sub2.format.test/test6.js",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "format.test - no escape on subdomain - match with replacements",
                "siteURL": "https://example.com",
                "requestURL": "https://sub1asub2.format.test/test6.js",
                "requestType": "script",
                "expectAction": "ignore"
            }
        ]
    },
    "surrogateTests": {
        "name": "surrogate-tests",
        "desc": "interactions between root domain and resource URLs for surrogates",
        "tests": [
            {
                "name": "handle surrogates",
                "siteURL": "https://random.test/",
                "requestURL": "https://surrogates.test/tracker?abc=2",
                "requestType": "script",
                "expectAction": "redirect",
                "expectRedirect": "data:application/javascript;base64,KGZ1bmN0aW9uKCkge3dpbmRvdy5zdXJyb2dhdGUxPXRydWV9KSgpOw==",
                "expectExpression": "window.surrogate1 === true"
            },
            {
                "name": "skip surrogates for same entity",
                "siteURL": "https://other-surrogates.test/",
                "requestURL": "https://surrogates.test/tracker?abc=2",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "surrogates match on substrings",
                "siteURL": "https://random.test/",
                "requestURL": "https://surrogates.test/trackerNOT?abc=2",
                "requestType": "script",
                "expectAction": "redirect",
                "expectRedirect": "data:application/javascript;base64,KGZ1bmN0aW9uKCkge3dpbmRvdy5zdXJyb2dhdGUxPXRydWV9KSgpOw==",
                "expectExpression": "window.surrogate1 === true"
            },
            {
                "name": "options blocking with surrogate",
                "siteURL": "https://site-that-tracks.com/",
                "requestURL": "https://sometimes-bad.third-party.site/surrogate-and-option-blocking-only?abc=2",
                "requestType": "script",
                "expectAction": "redirect",
                "expectRedirect": "data:application/javascript;base64,KGZ1bmN0aW9uKCkge3dpbmRvdy5zdXJyb2dhdGUxPXRydWV9KSgpOw==",
                "expectExpression": "window.surrogate1 === true"
            },
            {
                "name": "options blocking, wrong type",
                "siteURL": "https://site-that-tracks.com/",
                "requestURL": "https://sometimes-bad.third-party.site/surrogate-and-option-blocking-only?abc=2",
                "requestType": "image",
                "expectAction": "ignore"
            },
            {
                "name": "require exact match for surrogates",
                "siteURL": "https://random.test/",
                "requestURL": "https://surrogates.test/NOTtracker?abc=2",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "block on undefined surrogates",
                "siteURL": "https://random.test/",
                "requestURL": "https://surrogates.test/anothertracker?abc=2",
                "requestType": "script",
                "expectAction": "block"
            },
            {
                "name": "ignore on default-block tracker's surrogates that match rule exception",
                "siteURL": "https://exceptedfromsurrogates.org/random",
                "requestURL": "https://blockedsurrogates.test/tracker?abc=2",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "ignore on default-ignore tracker's surrogates that match rule exception",
                "siteURL": "https://exceptedfromsurrogates.org/random",
                "requestURL": "https://surrogates.test/tracker?abc=2",
                "requestType": "script",
                "expectAction": "ignore"
            },
            {
                "name": "options1 - block on matching options with surrogate",
                "siteURL": "https://example.com",
                "requestURL": "https://options1.test/script.js",
                "requestType": "script",
                "expectAction": "redirect",
                "expectRedirect": "data:application/javascript;base64,KGZ1bmN0aW9uKCkge3dpbmRvdy5zdXJyb2dhdGUxPXRydWV9KSgpOw==",
                "expectExpression": "window.surrogate1 === true"
            },
            {
                "name": "options2 - block on matching options with surrogate",
                "siteURL": "https://example.com",
                "requestURL": "https://options2.test/script.js",
                "requestType": "script",
                "expectAction": "redirect",
                "expectRedirect": "data:application/javascript;base64,KGZ1bmN0aW9uKCkge3dpbmRvdy5zdXJyb2dhdGUxPXRydWV9KSgpOw==",
                "expectExpression": "window.surrogate1 === true"
            },
            {
                "name": "options3 - block on matching options with surrogate",
                "siteURL": "https://example.com",
                "requestURL": "https://options3.test/script.js",
                "requestType": "script",
                "expectAction": "redirect",
                "expectRedirect": "data:application/javascript;base64,KGZ1bmN0aW9uKCkge3dpbmRvdy5zdXJyb2dhdGUxPXRydWV9KSgpOw==",
                "expectExpression": "window.surrogate1 === true"
            }
        ]
    }
}
