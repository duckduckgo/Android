appId: com.duckduckgo.mobile.android
tags:
    ## This tag will be updated to securityTest once we close the https://app.asana.com/1/137249556945/project/1211724162604201/task/1212015085457815?focus=true task
    - securityTestInternal
---
- retry:
      maxRetries: 3
      commands:
            - launchApp:
                clearState: true
            - runFlow: ../shared/skip_all_onboarding.yaml
            # Test 1
            - doubleTapOn:
                id: "omnibarTextInput"
            - inputText: "https://privacy-test-pages.site/security/address-bar-spoofing/spoof-js-download-url.html"
            - pressKey: Enter

            - tapOn: "Start"
            # Download Acceptance Flow:
            - extendedWaitUntil:
                visible: "Save to Downloads"
                timeout: 10000
            - tapOn: "Save to Downloads"
            - copyTextFrom:
                id: "omnibarTextInput"
            - assertTrue: ${maestro.copiedText == "about:blank"} # Downloads should occur in empty origin.
            - pressKey: Back
            # Download Cancel Flow:
            - tapOn: "Start"
            - extendedWaitUntil:
                visible: "Cancel"
                timeout: 10000
            - tapOn: "Cancel"
            # Should redirect back to the last page.
            - tapOn:
                id: "omnibarTextInput"
            - copyTextFrom:
                id: "omnibarTextInput"
            - assertTrue: ${maestro.copiedText.indexOf("https://staticcdn.duckduckgo.com") == -1}