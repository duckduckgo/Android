name: Update Content Scope Scripts

on:
  schedule:
    - cron: '30 1 * * *' # run at 1 AM UTC
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  update-content-scope-scripts:
    name: Update Content Scope scripts
    runs-on: ubuntu-latest

    steps:
      - name: Create Asana task in Android App project
        id: create-task
        uses: duckduckgo/native-github-asana-sync@v1.1
        with:
          asana-pat: ${{ vars.GH_ASANA_PLAYGROUND_PAT }}
          asana-project: ${{ vars.GH_ASANA_PLAYGROUND_PROJECT_ID }}
          asana-section: ${{ vars.GH_ASANA_PLAYGROUND_SECTION_ID }}
          asana-task-name: Update content scope scripts to version 10
          asana-task-description: |
            Content scope scripts have been updated and a PR created.

            If tests failed check out https://app.asana.com/0/1202561462274611/1203986899650836/f for further information on what to do next.

            See ${{ steps.create-pr.outputs.pull-request-url }}
          action: 'create-asana-task'

      - name: Add Asana task to Release Board project
        if: ${{ steps.create-task.outputs.duplicate == 'false' }}
        uses: duckduckgo/native-github-asana-sync@v1.0
        with:
          asana-pat: ${{ secrets.GH_ASANA_SECRET }}
          asana-project: ${{ vars.GH_ANDROID_RELEASE_BOARD_PROJECT_ID }}
          asana-section: ${{ vars.GH_ANDROID_RELEASE_BOARD_PR_SECTION_ID }}
          asana-task-id: ${{ steps.create-task.outputs.taskId }}
          action: 'add-task-asana-project'