name: Test - Workflow for Testing

on:
  workflow_dispatch:
    inputs:
      app-version:
        description: 'App Version for Release'
        required: true
        default: 'PLACEHOLDER'

env:
  emoji_start: ":flight_departure:" # üõ´
  emoji_info: ":information_source:" # ‚ÑπÔ∏è

concurrency:
  group: ${{ github.workflow }}-${{ github.event.inputs.app-version }}
  cancel-in-progress: true

jobs:
  notify_mattermost_start:
    name: 'Step 1: Notify Mattermost of Release start'
    uses: ./.github/workflows/notify_mattermost.yml
    with:
      mattermost-message: ${{env.emoji_start}} Starting release process for version ${{ github.event.inputs.app-version }}
      mattermost-channel-name: ${{ vars.MM_TEST_NOTIFY_CHANNEL }}
    secrets: inherit

  run_release_tests:
    name: 'Step 3: Run Release Tests'
    needs: notify_mattermost_start
    uses: ./.github/workflows/release_tests.yml
    with:
      app-version: ${{ github.event.inputs.app-version }}
      test-tag: 'omnibarTest'
    secrets: inherit

  notify_mattermost_finish:
    name: 'Step 1: Notify Mattermost of Release completed'
    uses: ./.github/workflows/notify_mattermost.yml
    needs: run_release_tests
    with:
      mattermost-message: ${{env.emoji_end}} Release ${{ github.event.inputs.app-version }} completed successfully and is now in review.
      mattermost-channel-name: ${{ vars.MM_TEST_NOTIFY_CHANNEL }}
    secrets: inherit