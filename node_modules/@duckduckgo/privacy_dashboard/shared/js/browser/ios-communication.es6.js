import { setupColorScheme } from './common.es6'

const { fetch: macosFetch, backgroundMessage, getBackgroundTabData } = require('./macos-communication.es6')

const setColorScheme = setupColorScheme()
window.onChangeTheme = function (themeName) {
    setColorScheme(themeName)
}

window.history.replaceState({}, '', window.location)

const fetch = (message) => {
    if (!window.webkit) {
        console.error('window.webkit not available')
        return
    }

    if (message.closePrivacyDashboard) {
        window.webkit.messageHandlers.privacyDashboardClose.postMessage()
    }

    if (message.checkBrokenSiteReportHandled) {
        window.webkit.messageHandlers.displayBrokenSiteReport.postMessage()
        return true // Return true to prevent HTML form from showing
    }

    macosFetch(message)
}

module.exports = {
    fetch: fetch,
    backgroundMessage: backgroundMessage,
    getBackgroundTabData: getBackgroundTabData
}
