const bel = require('bel')
const { isSiteWithOnlyOwnTrackers } = require('./utils.es6')
const i18n = window.DDG.base.i18n

module.exports = function (site, isMajorNetworksCount) {
    let trackerCount

    // when protections are enabled, only show the blocked tracker count
    if (site.protectionsEnabled) {
        trackerCount = site.trackersBlockedCount
    } else {
        // otherwise, when protections are disabled, just show the total count
        trackerCount = site.trackersCount
    }

    // when called with `isMajorNetworksCount`, override the rules above and just use the `majorTrackerNetworksCount`
    if (isMajorNetworksCount) {
        trackerCount = site.majorTrackerNetworksCount
    }

    const finalText = i18n.t('site:trackerNetworksDesc.title', {
        trackerCount,
        majorNetwork: isMajorNetworksCount,
        blocked: trackersBlocked(site)
    })

    return bel`${finalText}`
}

function trackersBlocked (site) {
    if (!site.protectionsEnabled) return false
    if (isSiteWithOnlyOwnTrackers(site)) return true
    if (site.trackersCount === 0) return false
    return true
}
